<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <title>
      
        HTB-Responder | FlowsecNagi's Home
      
    </title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/apple-touch-icon.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/favicon-32x32.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/favicon-16x16.png" />
    
    
      <link rel="mask-icon"
            href="/images/logo.svg"
            color="" />
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/normal.ttf);
        font-weight: normal;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css' />
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css"/>
  

  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    
      <div id="search-mask" style="display:none">
  <div class="search-main" id="search-main">
    <div class="search__head">
      <div class="search-form">
        <svg t="1706347533072"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="7828"
             width="20"
             height="20">
          <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
          </path>
        </svg>
        <input id="search-input" placeholder="æœç´¢æ–‡ç« ">
        <svg t="1706361500528"
             id="search-clear"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="4351"
             width="20"
             height="20">
          <path d="M512 562.688l-264.2944 264.2944-50.688-50.688L461.312 512 197.0176 247.7056l50.688-50.688L512 461.312l264.2944-264.2944 50.688 50.688L562.688 512l264.2944 264.2944-50.688 50.688L512 562.688z" fill="#00" p-id="4352">
          </path>
        </svg>
      </div>
    </div>
    <div class="search__body" id="search-result"></div>
    <div class="search__foot"></div>
  </div>
</div>

    
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo.svg" />
        </a>
        <input id="navBtn" type="checkbox" />
        <div class="nav-right">
          
            <div class="search-outer">
  <div class="search" id="search-btn">
    <svg t="1706347533072"
         class="icon"
         viewBox="0 0 1024 1024"
         version="1.1"
         xmlns="http://www.w3.org/2000/svg"
         p-id="7828"
         width="20"
         height="20">
      <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
      </path>
    </svg>
    <span>æœç´¢</span>
    <span class="search-shortcut-key">Ctrl K</span>
  </div>
</div>

          
          <div class="nav-menu">
            
              
                <a class="nav-menu-item" href="/%E7%A2%8E%E7%A2%8E%E5%BF%B5">åæŠ—è€…</a>
              
                <a class="nav-menu-item" href="/%E5%AD%A6%E4%B9%A0">é€ƒäº¡ä¹‹è·¯</a>
              
                <a class="nav-menu-item" href="/%E5%8E%AE%E6%9D%80%E6%88%98%E5%9C%BA">æˆ˜åœº</a>
              
                <a class="nav-menu-item" href="/%E7%A7%91%E7%A0%94">ç ”ç©¶æ‰€</a>
              
            
            
          </div>
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner">
      <div class="post-content__head">
        <div class="post-title">HTB-Responder</div>
        <div class="post-info">
          
  <a href="/tags/HTB/" class="post-tag">#HTB</a><a href="/tags/%E7%AC%94%E8%AE%B0/" class="post-tag">#ç¬”è®°</a><a href="/tags/STARTING-POINT/" class="post-tag">#STARTING POINT</a>


          <span class="post-date">2023-07-12</span>
        </div>
      </div>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <h1 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Windows is the most predominant operating system in todayâ€™s world because of its easy-to-use GUI accessibility. About 85% of the market share has become a critical OS to attack. Furthermore, most organizations use Active Directory to set up their Windows domain networks. Microsoft employs NTLM (New Technology LAN Manager) &amp; Kerberos for authentication services. Despite known vulnerabilities, NTLM remains widely deployed even on new systems to maintain compatibility with legacy clients and servers.<br>This lab focuses on how a File Inclusion vulnerability on a webpage being served on a windows machine can be exploited to collect the NetNTLMv2 challenge of the user that is running the web server. We will use a utility called Responder to capture a NetNTLMv2 hash and later use a utility known as john the ripper to test millions of potential passwords to see if they match the one used to create the hash. We will also be taking a deeper look at the working process of NTLM authentication and how the Responder utility captures the challenge. We believe that itâ€™s crucial to understand the under the hood workings of a tool or a framework as it strengthens the foundation of oneâ€™s understanding, which aids in the real world exploit scenarios that one might face, which do not appear to be vulnerable at the first look. Letâ€™s dive straight into it.</p>
<hr>
<p>Windowsæ˜¯å½“ä»Šä¸–ç•Œä¸Šæœ€ä¸»è¦çš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºå®ƒæ˜“äºä½¿ç”¨çš„GUIå¯è®¿é—®æ€§ã€‚å¤§çº¦85%çš„å¸‚åœºä»½é¢å·²ç»æˆä¸ºæ”»å‡»çš„å…³é”®æ“ä½œç³»ç»Ÿã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°ç»„ç»‡éƒ½ä½¿ç”¨Active Directoryæ¥è®¾ç½®å…¶WindowsåŸŸç½‘ç»œã€‚Microsoftä½¿ç”¨NTLMï¼ˆæ–°æŠ€æœ¯å±€åŸŸç½‘ç®¡ç†å™¨ï¼‰å’ŒKerberosè¿›è¡Œèº«ä»½éªŒè¯æœåŠ¡ã€‚å°½ç®¡å­˜åœ¨å·²çŸ¥çš„æ¼æ´ï¼ŒNTLMä»ç„¶è¢«å¹¿æ³›éƒ¨ç½²åœ¨æ–°ç³»ç»Ÿä¸Šï¼Œä»¥ä¿æŒä¸æ—§å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„å…¼å®¹æ€§ã€‚<br>æœ¬å®éªŒå®¤çš„é‡ç‚¹æ˜¯å¦‚ä½•åˆ©ç”¨windowsè®¡ç®—æœºä¸Šæä¾›çš„ç½‘é¡µä¸Šçš„æ–‡ä»¶åŒ…å«æ¼æ´æ¥æ”¶é›†è¿è¡ŒwebæœåŠ¡å™¨çš„ç”¨æˆ·çš„NetNTLMv2æŒ‘æˆ˜ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸ºResponderçš„å®ç”¨ç¨‹åºæ¥æ•è·NetNTLMv2å“ˆå¸Œï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªç§°ä¸ºjohn the ripperçš„å®ç”¨ç¨‹åºæµ‹è¯•æ•°ç™¾ä¸‡ä¸ªæ½œåœ¨å¯†ç ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦ä¸ç”¨äºåˆ›å»ºå“ˆå¸Œçš„å¯†ç åŒ¹é…ã€‚æˆ‘ä»¬è¿˜å°†æ·±å…¥äº†è§£NTLMèº«ä»½éªŒè¯çš„å·¥ä½œè¿‡ç¨‹ï¼Œä»¥åŠå“åº”ç¨‹åºå®ç”¨ç¨‹åºå¦‚ä½•åº”å¯¹è¿™ä¸€æŒ‘æˆ˜ã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œç†è§£ä¸€ä¸ªå·¥å…·æˆ–æ¡†æ¶çš„å¹•åå·¥ä½œè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒåŠ å¼ºäº†äººä»¬ç†è§£çš„åŸºç¡€ï¼Œæœ‰åŠ©äºåœ¨ç°å®ä¸–ç•Œä¸­åˆ©ç”¨äººä»¬å¯èƒ½é¢ä¸´çš„åœºæ™¯ï¼Œè€Œè¿™äº›åœºæ™¯ä¹ä¸€çœ‹å¹¶ä¸è„†å¼±ã€‚è®©æˆ‘ä»¬ç›´æ¥åˆ‡å…¥ã€‚</p>
<h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><p>We will begin by scanning the host for any open ports and running services with a Nmap scan. We will be using the following flags for the scan:</p>
<aside>
ğŸ“ p- : This flag scans for all TCP ports ranging from 0-65535
-sV : Attempts to determine the version of the service running on a port
--min-rate : This is used to specify the minimum number of packets Nmap should send per
second; it speeds up the scan as the number goes higher


</aside>

<blockquote>
<p>Nmapå¦‚ä½•ç¡®å®šç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡ï¼Ÿ<br>Nmapä½¿ç”¨çŸ¥åæœåŠ¡çš„ç«¯å£æœåŠ¡æ•°æ®åº“æ¥ç¡®å®šåœ¨ç‰¹å®šç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡ã€‚å®ƒç¨åè¿˜ä¼šå‘è¯¥ç«¯å£å‘é€ä¸€äº›ç‰¹å®šäºæœåŠ¡çš„è¯·æ±‚ï¼Œä»¥ç¡®å®šæœåŠ¡ç‰ˆæœ¬å’Œä»»ä½•æœ‰å…³å®ƒçš„é™„åŠ ä¿¡æ¯ã€‚<br>å› æ­¤ï¼Œå¯¹äºç‰¹å®šç«¯å£çš„æœåŠ¡ä¿¡æ¯ï¼ŒNmapå¤§å¤šæ˜¯ä½†å¹¶ä¸æ€»æ˜¯æ­£ç¡®çš„ã€‚</p>
</blockquote>
<p>According to the results of the Nmap scan, the machine is using Windows as its operating system. Two ports were detected as open having Apache web server running on port 80 along with WinRM on port 5985 .</p>
<p>æ ¹æ®Nmapæ‰«æçš„ç»“æœï¼Œè¯¥æœºå™¨æ­£åœ¨ä½¿ç”¨Windowsä½œä¸ºå…¶æ“ä½œç³»ç»Ÿã€‚æ£€æµ‹åˆ°ä¸¤ä¸ªç«¯å£æ‰“å¼€ï¼ŒApache webæœåŠ¡å™¨åœ¨ç«¯å£80ä¸Šè¿è¡Œï¼ŒWinRMåœ¨ç«¯å£5985ä¸Šè¿è¡Œã€‚</p>
<aside>
â“ Windows Remote Management, or WinRM, is a Windows-native built-in remote management protocol that basically uses Simple Object Access Protocol to interact with remote computers and servers, as well as Operating Systems and applications. WinRM allows the user to :
â†’ Remotely communicate and interface with hosts
â†’ Execute commands remotely on systems that are not local to you but are network accessible.
â†’ Monitor, manage and configure servers, operating systems and client machines from a remote location.
As a pentester, this means that if we can find credentials (typically username and password) for a user who has remote management privileges, we can potentially get a PowerShell shell on the host.


</aside>

<aside>
â“ Windowsè¿œç¨‹ç®¡ç†ï¼ˆWinRMï¼‰æ˜¯ä¸€ç§Windowsæœ¬æœºå†…ç½®è¿œç¨‹ç®¡ç†åè®®ï¼ŒåŸºæœ¬ä¸Šä½¿ç”¨ç®€å•å¯¹è±¡è®¿é—®åè®®ä¸è¿œç¨‹è®¡ç®—æœºå’ŒæœåŠ¡å™¨ä»¥åŠæ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚WinRMå…è®¸ç”¨æˆ·ï¼š
â†’ ä¸ä¸»æœºè¿œç¨‹é€šä¿¡å’Œæ¥å£
â†’ åœ¨éæœ¬åœ°ä½†å¯é€šè¿‡ç½‘ç»œè®¿é—®çš„ç³»ç»Ÿä¸Šè¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚
â†’ ä»è¿œç¨‹ä½ç½®ç›‘è§†ã€ç®¡ç†å’Œé…ç½®æœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿå’Œå®¢æˆ·ç«¯æœºå™¨ã€‚
ä½œä¸ºpentesterï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬èƒ½æ‰¾åˆ°å…·æœ‰è¿œç¨‹ç®¡ç†æƒé™çš„ç”¨æˆ·çš„å‡­æ®ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œæˆ‘ä»¬å°±æœ‰å¯èƒ½åœ¨ä¸»æœºä¸Šè·å¾—PowerShell shellã€‚


</aside>

<h2 id="Website-Enumeration"><a href="#Website-Enumeration" class="headerlink" title="Website Enumeration"></a>Website Enumeration</h2><p>On opening Firefox and putting http:&#x2F;&#x2F;[target ip] , the browser returns a message about being unable to find that site. Looking in the URL bar, it now shows <a target="_blank" rel="noopener" href="http://unika.htb/">http://unika.htb</a> . The website has redirected the browser to a new URL, and your host doesnâ€™t know how to find unika.htb . This webserver is employing name-based Virtual Hosting for serving the requests.</p>
<p>æ‰“å¼€Firefoxå¹¶æ”¾å…¥http:&#x2F;&#x2F;[target-ip]åï¼Œæµè§ˆå™¨ä¼šè¿”å›ä¸€æ¡æ— æ³•æ‰¾åˆ°è¯¥ç½‘ç«™çš„æ¶ˆæ¯ã€‚åœ¨URLæ ä¸­æŸ¥çœ‹ï¼Œå®ƒç°åœ¨æ˜¾ç¤º<a target="_blank" rel="noopener" href="http://unika.htb.è¯¥ç½‘ç«™å·²å°†æµè§ˆå™¨é‡å®šå‘åˆ°ä¸€ä¸ªæ–°çš„url,è€Œæ‚¨çš„ä¸»æœºä¸çŸ¥é“å¦‚ä½•æ‰¾åˆ°unika.htb.è¯¥webæœåŠ¡å™¨ä½¿ç”¨åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºæ¥æ»¡è¶³è¯·æ±‚./">http://unika.htbã€‚è¯¥ç½‘ç«™å·²å°†æµè§ˆå™¨é‡å®šå‘åˆ°ä¸€ä¸ªæ–°çš„URLï¼Œè€Œæ‚¨çš„ä¸»æœºä¸çŸ¥é“å¦‚ä½•æ‰¾åˆ°unika.htbã€‚è¯¥WebæœåŠ¡å™¨ä½¿ç”¨åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºæ¥æ»¡è¶³è¯·æ±‚ã€‚</a></p>
<p>Name-Based Virtual hosting is a method for hosting multiple domain names (with separate handling ofeach name) on a single server. This allows one server to share its resources, such as memory and processor cycles, without requiring all the services to be used by the same hostname.<br>The web server checks the domain name provided in the Host header field of the HTTP request and sends a response according to that.</p>
<p>åŸºäºåç§°çš„è™šæ‹Ÿæ‰˜ç®¡æ˜¯ä¸€ç§åœ¨å•ä¸ªæœåŠ¡å™¨ä¸Šæ‰˜ç®¡å¤šä¸ªåŸŸåï¼ˆæ¯ä¸ªåç§°å•ç‹¬å¤„ç†ï¼‰çš„æ–¹æ³•ã€‚è¿™å…è®¸ä¸€å°æœåŠ¡å™¨å…±äº«å…¶èµ„æºï¼Œä¾‹å¦‚å†…å­˜å’Œå¤„ç†å™¨å‘¨æœŸï¼Œè€Œä¸éœ€è¦åŒä¸€ä¸»æœºåä½¿ç”¨æ‰€æœ‰æœåŠ¡ã€‚<br>webæœåŠ¡å™¨æ£€æŸ¥HTTPè¯·æ±‚çš„ä¸»æœºå¤´å­—æ®µä¸­æä¾›çš„åŸŸåï¼Œå¹¶æ ¹æ®è¯¥åŸŸåå‘é€å“åº”ã€‚<br>The &#x2F;etc&#x2F;hosts file is used to resolve a hostname into an IP address &amp; thus we will need to add an entry in the &#x2F;etc&#x2F;hosts file for this domain to enable the browser to resolve the address for unika.htb .</p>
<p>&#x2F;etc&#x2F;hostsæ–‡ä»¶ç”¨äºå°†ä¸»æœºåè§£æä¸ºIPåœ°å€&amp;å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¯¥åŸŸçš„&#x2F;etc&#x2F;hostæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼Œä»¥ä½¿æµè§ˆå™¨èƒ½å¤Ÿè§£æunika.htbçš„åœ°å€ã€‚</p>
<p>Entry in the &#x2F;etc&#x2F;hosts file :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10.129.136.91 unika.htb&quot;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> -a /etc/hosts<br></code></pre></td></tr></table></figure>

<p>Adding this entry in the &#x2F;etc&#x2F;hosts file will enable the browser to resolve the hostname unika.htb to<br>the corresponding IP address &amp; thus make the browser include the HTTP header Host: unika.htb in<br>every HTTP request that the browser sends to this IP address, which will make the server respond with the webpage for unika.htb .</p>
<p>åœ¨&#x2F;etc&#x2F;hostsæ–‡ä»¶ä¸­æ·»åŠ æ­¤æ¡ç›®å°†ä½¿æµè§ˆå™¨èƒ½å¤Ÿå°†ä¸»æœºåunika.htbè§£æä¸ºç›¸åº”çš„IPåœ°å€ï¼Œä»è€Œä½¿æµè§ˆå™¨åœ¨å‘è¯¥IPåœ°å€å‘é€çš„æ¯ä¸ªHTTPè¯·æ±‚ä¸­éƒ½åŒ…å«HTTPæ ‡å¤´Host:unika.htbï¼Œè¿™å°†ä½¿æœåŠ¡å™¨ä»¥unika.hç»“æ ¸çš„ç½‘é¡µè¿›è¡Œå“åº”ã€‚<br>On accessing the web page we are presented with a web designing business landing page.</p>
<p>åœ¨è®¿é—®ç½‘é¡µæ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªç½‘é¡µè®¾è®¡ä¸šåŠ¡ç™»å½•é¡µã€‚</p>
<p>Checking the site out, we see nothing of particular interest. Although, we notice a language selection option on the navbar EN and changing the option to FR takes us to a French version of the website.</p>
<p>æŸ¥çœ‹ç½‘ç«™ï¼Œæˆ‘ä»¬æ²¡æœ‰å‘ç°ä»»ä½•ç‰¹åˆ«æ„Ÿå…´è¶£çš„ä¸œè¥¿ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å¯¼èˆªæ ENä¸Šæœ‰ä¸€ä¸ªè¯­è¨€é€‰æ‹©é€‰é¡¹ï¼Œå°†è¯¥é€‰é¡¹æ›´æ”¹ä¸ºFRä¼šå°†æˆ‘ä»¬å¸¦åˆ°è¯¥ç½‘ç«™çš„æ³•è¯­ç‰ˆæœ¬ã€‚</p>
<p>Noticing the URL, we can see that the french.html page is being loaded by the page parameter, which may potentially be vulnerable to a Local File Inclusion (LFI) vulnerability if the page input is not sanitized.</p>
<p>æ³¨æ„åˆ°URLï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°french.htmlé¡µé¢æ˜¯ç”±é¡µé¢å‚æ•°åŠ è½½çš„ï¼Œå¦‚æœé¡µé¢è¾“å…¥æ²¡æœ‰è¢«æ¸…é™¤ï¼Œå®ƒå¯èƒ½ä¼šå—åˆ°æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ¼æ´çš„æ”»å‡»ã€‚</p>
<h2 id="File-Inclusion-Vulnerability"><a href="#File-Inclusion-Vulnerability" class="headerlink" title="File Inclusion Vulnerability"></a>File Inclusion Vulnerability</h2><p>Dynamic websites include HTML pages on the fly using information from the HTTP request to include GET and POST parameters, cookies, and other variables. It is common for a page to â€œincludeâ€ another page based on some of these parameters.</p>
<p>åŠ¨æ€ç½‘ç«™åŒ…æ‹¬åŠ¨æ€HTMLé¡µé¢ï¼Œä½¿ç”¨HTTPè¯·æ±‚ä¸­çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬GETå’ŒPOSTå‚æ•°ã€cookieå’Œå…¶ä»–å˜é‡ã€‚ä¸€ä¸ªé¡µé¢é€šå¸¸ä¼šæ ¹æ®å…¶ä¸­ä¸€äº›å‚æ•°â€œåŒ…å«â€å¦ä¸€ä¸ªé¡µé¢ã€‚</p>
<aside>
ğŸ’¡ LFI or Local File Inclusion occurs when an attacker is able to get a website to include a file that was not intended to be an option for this application. A common example is when an application uses the path to a file as input. If the application treats this input as trusted, and the required sanitary checks are not performed on this input, then the attacker can exploit it by using the ../ string in the inputted file name and eventually view sensitive files in the local file system. In some limited cases, an LFI can lead to code execution as well.


</aside>

<p>å½“æ”»å‡»è€…èƒ½å¤Ÿä½¿ç½‘ç«™åŒ…å«ä¸€ä¸ªä¸æ‰“ç®—ä½œä¸ºæ­¤åº”ç”¨ç¨‹åºé€‰é¡¹çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‘ç”ŸLFIæˆ–æœ¬åœ°æ–‡ä»¶åŒ…å«ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯åº”ç”¨ç¨‹åºä½¿ç”¨æ–‡ä»¶çš„è·¯å¾„ä½œä¸ºè¾“å…¥ã€‚å¦‚æœåº”ç”¨ç¨‹åºå°†æ­¤è¾“å…¥è§†ä¸ºå¯ä¿¡è¾“å…¥ï¼Œå¹¶ä¸”æœªå¯¹æ­¤è¾“å…¥æ‰§è¡Œæ‰€éœ€çš„å«ç”Ÿæ£€æŸ¥ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥ä½¿ç”¨..&#x2F;å­—ç¬¦ä¸²ï¼Œå¹¶æœ€ç»ˆæŸ¥çœ‹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•æ„Ÿæ–‡ä»¶ã€‚åœ¨æŸäº›æœ‰é™çš„æƒ…å†µä¸‹ï¼ŒLFIä¹Ÿå¯ä»¥å¯¼è‡´ä»£ç æ‰§è¡Œã€‚</p>
<aside>
ğŸ’¡ RFI or Remote File Inclusion is similar to LFI but in this case it is possible for an attacker to load a remote file on the host using protocols like HTTP, FTP etc.


</aside>

<p>RFIæˆ–è¿œç¨‹æ–‡ä»¶åŒ…å«ç±»ä¼¼äºLFIï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…æœ‰å¯èƒ½ä½¿ç”¨HTTPã€FTPç­‰åè®®åœ¨ä¸»æœºä¸ŠåŠ è½½è¿œç¨‹æ–‡ä»¶ã€‚</p>
<p>We test the page parameter to see if we can include files on the target system in the server response. We will test with some commonly known files that will have the same name across networks, Windows domains, and systems which can be found here. One of the most common files that a penetration tester might attempt to access on a Windows machine to verify LFI is the hosts file, WINDOWS\System32\drivers\etc\hosts (this file aids in the local translation of host names to IP<br>addresses). The ..&#x2F; string is used to traverse back a directory, one at a time. Thus multiple ..&#x2F; strings are included in the URL so that the file handler on the server traverses back to the base directory i.e. C:\ .</p>
<p>æˆ‘ä»¬æµ‹è¯•é¡µé¢å‚æ•°ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥åœ¨æœåŠ¡å™¨å“åº”ä¸­åŒ…æ‹¬ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€äº›å¸¸è§çš„æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œè¿™äº›æ–‡ä»¶å°†åœ¨ç½‘ç»œã€WindowsåŸŸå’Œç³»ç»Ÿä¸­å…·æœ‰ç›¸åŒçš„åç§°ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°ã€‚æ¸—é€æµ‹è¯•äººå‘˜å¯èƒ½è¯•å›¾åœ¨Windowsæœºå™¨ä¸Šè®¿é—®ä»¥éªŒè¯LFIçš„æœ€å¸¸è§æ–‡ä»¶ä¹‹ä¸€æ˜¯hostsæ–‡ä»¶Windows\System32\drivers\etc\hostsï¼ˆè¯¥æ–‡ä»¶æœ‰åŠ©äºå°†ä¸»æœºåæœ¬åœ°è½¬æ¢ä¸ºIPåœ°å€ï¼‰ã€‚..&#x2F;å­—ç¬¦ä¸²ç”¨äºä¸€æ¬¡éå†ä¸€ä¸ªç›®å½•ã€‚å› æ­¤å€æ•°..&#x2F;å­—ç¬¦ä¸²åŒ…å«åœ¨URLä¸­ï¼Œä»¥ä¾¿æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¤„ç†ç¨‹åºéå†å›åŸºæœ¬ç›®å½•ï¼Œå³C:\ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://unika.htb/index.php?<br>page=../../../../../../../../windows/system32/drivers/etc/hosts<br></code></pre></td></tr></table></figure>

<p>Great, LFI is possible as we can view the contents of the C:\windows\system32\drivers\etc\hosts file in the response.</p>
<p>å¾ˆå¥½ï¼ŒLFIæ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨å“åº”ä¸­æŸ¥çœ‹C:\windows\system32\drivers\etc\hostsæ–‡ä»¶çš„å†…å®¹ã€‚<br>The file inclusion, in this case, was made possible because in the backend the include() method of PHP is being used to process the URL parameter page for serving a different webpage for different languages. And because no proper sanitization is being done on this page parameter, we were able to pass malicious input and therefore view the internal system files.<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹‹æ‰€ä»¥å¯ä»¥åŒ…å«æ–‡ä»¶ï¼Œæ˜¯å› ä¸ºåœ¨åç«¯ï¼ŒPHPçš„includeï¼ˆï¼‰æ–¹æ³•è¢«ç”¨äºå¤„ç†URLå‚æ•°é¡µé¢ï¼Œä»¥ä¾¿ä¸ºä¸åŒè¯­è¨€çš„ä¸åŒç½‘é¡µæä¾›æœåŠ¡ã€‚ç”±äºæ²¡æœ‰å¯¹æ­¤é¡µé¢å‚æ•°è¿›è¡Œé€‚å½“çš„æ¸…ç†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä¼ é€’æ¶æ„è¾“å…¥ï¼Œä»è€ŒæŸ¥çœ‹å†…éƒ¨ç³»ç»Ÿæ–‡ä»¶ã€‚</p>
<p><strong>What is the include() method in PHP?</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php">File <span class="hljs-number">1</span> --&gt; vars.php<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$color</span> = <span class="hljs-string">&#x27;green&#x27;</span>;<br><span class="hljs-variable">$fruit</span> = <span class="hljs-string">&#x27;apple&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">#############################################</span><br>File <span class="hljs-number">2</span> --&gt; test.php<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;A <span class="hljs-subst">$color</span> <span class="hljs-subst">$fruit</span>&quot;</span>; <span class="hljs-comment">// output = &quot;A&quot;</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;vars.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;A <span class="hljs-subst">$color</span> <span class="hljs-subst">$fruit</span>&quot;</span>; <span class="hljs-comment">// output = &quot;A green apple&quot;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/en/function.include.php">https://www.php.net/manual/en/function.include.php</a></p>
<p><strong>What is NTLM (New Technology Lan Manager)?</strong></p>
<p>NTLM is a collection of authentication protocols created by Microsoft. It is a challenge-response<br>authentication protocol used to authenticate a client to a resource on an Active Directory domain.<br>It is a type of single sign-on (SSO) because it allows the user to provide the underlying authentication factor only once, at login.</p>
<p>NTLMæ˜¯ç”±Microsoftåˆ›å»ºçš„èº«ä»½éªŒè¯åè®®çš„é›†åˆã€‚å®ƒæ˜¯ä¸€ç§è´¨è¯¢-å“åº”èº«ä»½éªŒè¯åè®®ï¼Œç”¨äºå°†å®¢æˆ·ç«¯èº«ä»½éªŒè¯ä¸ºActive DirectoryåŸŸä¸Šçš„èµ„æºã€‚<br>å®ƒæ˜¯ä¸€ç§å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ï¼Œå› ä¸ºå®ƒåªå…è®¸ç”¨æˆ·åœ¨ç™»å½•æ—¶æä¾›ä¸€æ¬¡åº•å±‚èº«ä»½éªŒè¯å› ç´ ã€‚</p>
<p>The NTLM authentication process is done in the following way :</p>
<ol>
<li>The client sends the user name and domain name to the server.</li>
<li>The server generates a random character string, referred to as the challenge.</li>
<li>The client encrypts the challenge with the NTLM hash of the user password and sends it back to the server.</li>
<li>The server retrieves the user password (or equivilent).</li>
<li>The server uses the hash value retrieved from the security account database to encrypt the challenge string. The value is then compared to the value received from the client. If the values match, the client is authenticated.</li>
</ol>
<aside>
ğŸ’¡ NTLMèº«ä»½éªŒè¯è¿‡ç¨‹é€šè¿‡ä»¥ä¸‹æ–¹å¼å®Œæˆï¼š
1.å®¢æˆ·ç«¯å°†ç”¨æˆ·åå’ŒåŸŸåå‘é€ç»™æœåŠ¡å™¨ã€‚
2.æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œç§°ä¸ºæŒ‘æˆ˜ã€‚
3.å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·å¯†ç çš„NTLMå“ˆå¸Œå¯¹è´¨è¯¢è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†å…¶å‘é€å›æœåŠ¡å™¨ã€‚
4.æœåŠ¡å™¨æ£€ç´¢ç”¨æˆ·å¯†ç ï¼ˆæˆ–ç­‰æ•ˆå¯†ç ï¼‰ã€‚
5.æœåŠ¡å™¨ä½¿ç”¨ä»å®‰å…¨å¸æˆ·æ•°æ®åº“ä¸­æ£€ç´¢åˆ°çš„å“ˆå¸Œå€¼æ¥åŠ å¯†è´¨è¯¢å­—ç¬¦ä¸²ã€‚ç„¶åå°†è¯¥å€¼ä¸ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå€¼åŒ¹é…ï¼Œåˆ™å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ã€‚


</aside>

<p>NTLMä¸NTHashä¸NetNTLMv2</p>
<p>å…³äºNTLMèº«ä»½éªŒè¯çš„æœ¯è¯­å¾ˆæ··ä¹±ï¼Œç”šè‡³ä¸“ä¸šäººå£«ä¹Ÿä¼šä¸æ—¶æ»¥ç”¨å®ƒï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®šä¹‰ä¸€äº›å…³é”®æœ¯è¯­ï¼š</p>
<ul>
<li>æ•£åˆ—å‡½æ•°æ˜¯ä¸€ç§å•å‘å‡½æ•°ï¼Œå®ƒæ¥å—ä»»æ„æ•°é‡çš„æ•°æ®å¹¶è¿”å›å›ºå®šå¤§å°çš„å€¼ã€‚<br>é€šå¸¸ï¼Œç»“æœè¢«ç§°ä¸ºæ•£åˆ—ã€æ‘˜è¦æˆ–æŒ‡çº¹ã€‚å®ƒä»¬ç”¨äºæ›´å®‰å…¨åœ°å­˜å‚¨å¯†ç ï¼Œå› ä¸ºæ— æ³•å°†å“ˆå¸Œç›´æ¥è½¬æ¢å›åŸå§‹æ•°æ®ï¼ˆå°½ç®¡ä¹Ÿæœ‰è¯•å›¾ä»å“ˆå¸Œä¸­æ¢å¤å¯†ç çš„æ”»å‡»ï¼Œæˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ï¼‰ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨å¯ä»¥å­˜å‚¨æ‚¨çš„å¯†ç æ•£åˆ—ï¼Œå½“æ‚¨å°†å¯†ç æäº¤åˆ°ç½‘ç«™æ—¶ï¼Œå®ƒä¼šå¯¹æ‚¨çš„è¾“å…¥è¿›è¡Œæ•£åˆ—ï¼Œå¹¶å°†ç»“æœä¸æ•°æ®åº“ä¸­çš„æ•£åˆ—è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå®ƒä»¬åŒ¹é…ï¼Œå®ƒå°±ä¼šçŸ¥é“æ‚¨æä¾›äº†æ­£ç¡®çš„å¯†ç ã€‚</li>
<li>NTHashæ˜¯ç”¨äºåœ¨SAMæ•°æ®åº“å’ŒåŸŸæ§åˆ¶å™¨ä¸­çš„Windowsç³»ç»Ÿä¸Šå­˜å‚¨å¯†ç çš„ç®—æ³•çš„è¾“å‡ºã€‚NTHashé€šå¸¸è¢«ç§°ä¸ºNTLMå“ˆå¸Œï¼Œç”šè‡³åªæ˜¯NTLMï¼Œè¿™éå¸¸å…·æœ‰è¯¯å¯¼æ€§&#x2F;æ··æ·†æ€§ã€‚</li>
<li>å½“NTLMåè®®æƒ³è¦é€šè¿‡ç½‘ç»œè¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œå®ƒä¼šä½¿ç”¨å¦‚ä¸Šæ‰€è¿°çš„è´¨è¯¢&#x2F;å“åº”æ¨¡å‹ã€‚NetNTLMv2è´¨è¯¢&#x2F;å“åº”æ˜¯ä¸€ä¸ªä¸“é—¨æ ¼å¼åŒ–ä¸ºåŒ…æ‹¬è´¨è¯¢å’Œå“åº”çš„å­—ç¬¦ä¸²ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºNetNTLMv2å“ˆå¸Œï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯å“ˆå¸Œã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒé€šå¸¸è¢«ç§°ä¸ºå“ˆå¸Œï¼Œå› ä¸ºæˆ‘ä»¬ä»¥åŒæ ·çš„æ–¹å¼æ”»å‡»å®ƒã€‚æ‚¨å°†çœ‹åˆ°NetNTLMv2å¯¹è±¡è¢«ç§°ä¸ºNTLMv2ï¼Œç”šè‡³è¢«æ··æ·†ä¸ºNTLMã€‚</li>
</ul>
<h2 id="Using-Responder"><a href="#Using-Responder" class="headerlink" title="Using Responder"></a>Using Responder</h2>
      </div>
    </div>
    
      <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script>
      <script>
        if (window.mermaid) {
          mermaid.initialize({"startOnload":true});
        }
      </script>
    
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2023/07/13/%E5%8E%86%E7%BB%8F%E5%8D%81%E5%B9%B4%E6%89%BE%E5%AF%BB%E6%AF%95%E7%94%9F%E7%83%AD%E7%88%B1%E4%B9%8B%E4%BA%8B/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
        <span class="text-small">ä¸Šä¸€ç¯‡</span>
      </div>
      <div>å†ç»åå¹´æ‰¾å¯»æ¯•ç”Ÿçƒ­çˆ±ä¹‹äº‹</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2023/07/11/web%E6%94%BB%E9%98%B2%E7%AC%94%E8%AE%B0%E7%AC%AC44%E5%A4%A9/">
      <div class="text-align">
        <span class="text-small">ä¸‹ä¸€ç¯‡</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
      </div>
      webæ”»é˜²ç¬”è®°ç¬¬44å¤©
    </a>
  
</div>

    
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              <div class="matts">äºº</div><div class="matts">äºº</div><div class="matts">ä¸º</div><div class="matts">æˆ‘</div>
            </div>
          
            <div class="foot-line">
              <div class="matts">æˆ‘</div><div class="matts">ä¸º</div><div class="matts">äºº</div><div class="matts">äºº</div>
            </div>
          
        </div>
        <div class="foot__body">
          
            <div class="foot-item">
              <div class="foot-item__head">æœ‹å‹</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/icon/icon-link.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">Theme Tranquility</a>
                  </div>
                
                <div class="text">
                  <img alt="link" height="20px" width="20px" src="/images/icon/icon-link+.svg" />
                  <a class="foot-link"
                     href="mailto:flow63681@gmail.com?subject=%E7%94%B3%E8%AF%B7%20Hozen.site%20%E7%9A%84%E5%8F%8B%E9%93%BE%E4%BD%8D%E7%BD%AE">
                  ç”³è¯·å‹é“¾</a>
                </div>
              </div>
            </div>
          
          
            <div class="foot-item">
              <div class="foot-item__head">è´¦å·</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/ABCkillmen">github</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-wx.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://www.freebuf.com/author/FlowsecNagi">Freebuf</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-zh.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://www.zhihu.com/">çŸ¥ä¹</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">è”ç³»</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link" height="20px" width="20px" src="/images/icon/icon-email.svg" />
                <a class="foot-link" href="mailto:flow63681@gmail.com">flow63681@gmail.com</a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="http://example.com">FlowsecNagi's Home</a> &nbsp;|&nbsp;ç”±&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;åŠ&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z" />
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z" />
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z" />
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">è‡´è¿œ</a>&nbsp;é©±åŠ¨
        </div>
      </div>
    </div>
    
    
      <script src="/js/search.js"></script>
      <script>searchInitialize("/search.json")</script>
    
    
  

  </body>
</html>
